name: ella
base: ubuntu@24.04
build-base: ubuntu@24.04
adopt-info: ella-release-data
summary: Ella is a secure, reliable, and easy to operate mobile network.
description: Ella is a secure, reliable, and easy to operate mobile network.
platforms:
  amd64:

parts:

  ella:
    plugin: go
    source: .
    build-snaps:
      - go/1.22/stable
      - node/20/stable
    override-build: |
      npm install --prefix ui
      npm run build --prefix ui
      craftctl default

  ip:
    plugin: nil
    stage-packages:
      - iproute2

  tcpdump:
    plugin: nil
    stage-packages:
      - tcpdump
    overlay-script: |
      useradd -R $CRAFT_OVERLAY -M -r tcpdump

  iptables:
    plugin: nil
    stage-packages:
      - iptables

  ella-release-data:
    plugin: nil
    source: .
    override-build: |
      version="$(cat version/VERSION)"
      craftctl set version="$version"
