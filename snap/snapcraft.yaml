name: ella
base: core22
adopt-info: ella-release-data
summary: ella is a secure, reliable, and easy to operate mobile network.
description: |
  ella is a secure, reliable, and easy to operate mobile network.

grade: devel
confinement: devmode

apps:
  ella:
    daemon: simple
    install-mode: disable
    command: bin/ella-start
    refresh-mode: endure
    restart-condition: on-failure

parts:
  ella:
    plugin: go
    source: .
    source-type: local
    build-snaps:
      - go/1.23/stable
      - node/20/stable
    override-build: |
      npm install --prefix ui
      npm run build --prefix ui
      craftctl default

  service-files:
    plugin: dump
    source: service

  ella-release-data:
    plugin: nil
    source: .
    override-build: |
      version="$(cat version/VERSION)"
      craftctl set version="$version"