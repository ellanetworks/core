name: ella
base: core22
version: '0.0.0'
summary: ella is a secure, reliable, and easy to operate mobile network.
description: |
  ella is a secure, reliable, and easy to operate mobile network.

grade: devel
confinement: devmode

apps:
  ella:
    daemon: simple
    install-mode: disable
    command: bin/ella-start
    refresh-mode: endure
    restart-condition: on-failure

parts:
  frontend:
    plugin: nil
    source: ./ui
    build-snaps:
      - node/20/stable
    stage-snaps:
      - node/20/stable
    override-build: |
      craftctl default
      npm ci
      npm run build

      mkdir -p ${CRAFT_PART_INSTALL}/app
      cp -r out/* ${CRAFT_PART_INSTALL}/app/

  ella:
    plugin: go
    after:
      - frontend
    go-buildtags:
      - ui
    source: .
    build-snaps:
      - go/1.22/stable
    override-build: |
      rm -rf ${CRAFT_PART_BUILD}/ui/frontend_files/*
      cp -r ${CRAFT_STAGE}/app/* ${CRAFT_PART_BUILD}/internal/webui/ui/frontend_files
      craftctl default
  
  service-files:
    plugin: dump
    source: service
